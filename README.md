# ReactiveRoutesReproducer

This project uses Quarkus, the Supersonic Subatomic Java Framework.

If you want to learn more about Quarkus, please visit its website: <https://quarkus.io/>.

## Running the application

The application exposed 2 endpoints

- `GET /hello`: returnns "Hello World"
- `POST /echo`: echos back a JSON body

The application uses reactive Routes

## The problem

Running the application using `quarkus dev` with quarkus version `3.25.4` works as expected, but fails after upgrading to Quarkus `3.29.2' with an error stemming from inside the stack.

```log
ERROR [io.qua.dep.dev.IsolatedDevModeMain] (main) Failed to start quarkus: java.lang.RuntimeException: io.quarkus.builder.BuildException: Build failure: Build failed due to errors
	[error]: Build step io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor#addAdditionalRoutes threw an exception: java.lang.IllegalStateException: Item Invoke:RoutingContext.getBodyAsJson is not at its expected location (declare a LocalVar to store values which are used away from their creation site)
To track callers and get an improved exception message, add the system property `gizmo.debug`
	at io.quarkus.gizmo2.impl.Item.missing(Item.java:286)
	at io.quarkus.gizmo2.impl.Item.verify(Item.java:142)
	at io.quarkus.gizmo2.impl.Item.insertIfUnbound(Item.java:219)
	at io.quarkus.gizmo2.impl.Item.process(Item.java:260)
	at io.quarkus.gizmo2.impl.Invoke.forEachDependency(Invoke.java:80)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.addItem(BlockCreatorImpl.java:1444)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.invokeVirtual(BlockCreatorImpl.java:857)
	at io.quarkus.gizmo2.creator.BlockCreator.invokeVirtual(BlockCreator.java:2892)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$14(ReactiveRoutesProcessor.java:791)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.accept(BlockCreatorImpl.java:990)
	at io.quarkus.gizmo2.impl.TryCreatorImpl.lambda$body$0(TryCreatorImpl.java:41)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.nesting(BlockCreatorImpl.java:1514)
	at io.quarkus.gizmo2.impl.TryCreatorImpl.body(TryCreatorImpl.java:40)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$16(ReactiveRoutesProcessor.java:790)
	at io.quarkus.gizmo2.impl.TryCreatorImpl.accept(TryCreatorImpl.java:130)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.try_(BlockCreatorImpl.java:1153)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$23(ReactiveRoutesProcessor.java:789)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.accept(BlockCreatorImpl.java:990)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.doCode(ExecutableCreatorImpl.java:388)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.lambda$doBody$1(ExecutableCreatorImpl.java:304)
	at io.github.dmlloyd.classfile.impl.DirectCodeBuilder.build(DirectCodeBuilder.java:93)
	at io.github.dmlloyd.classfile.impl.DirectMethodBuilder.withCode(DirectMethodBuilder.java:118)
	at io.github.dmlloyd.classfile.impl.DirectMethodBuilder.withCode(DirectMethodBuilder.java:125)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.doBody(ExecutableCreatorImpl.java:303)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.lambda$body$3(ExecutableCreatorImpl.java:418)
	at io.github.dmlloyd.classfile.impl.DirectMethodBuilder.run(DirectMethodBuilder.java:139)
	at io.github.dmlloyd.classfile.impl.DirectClassBuilder.withMethod(DirectClassBuilder.java:117)
	at io.github.dmlloyd.classfile.ClassBuilder.withMethod(ClassBuilder.java:313)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.body(ExecutableCreatorImpl.java:417)
	at io.quarkus.gizmo2.impl.InstanceMethodCreatorImpl.body(InstanceMethodCreatorImpl.java:15)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$24(ReactiveRoutesProcessor.java:699)
	at io.quarkus.gizmo2.impl.InstanceMethodCreatorImpl.accept(InstanceMethodCreatorImpl.java:19)
	at io.quarkus.gizmo2.impl.ClassCreatorImpl.method(ClassCreatorImpl.java:76)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.generateInvoke(ReactiveRoutesProcessor.java:696)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateHandler$6(ReactiveRoutesProcessor.java:659)
	at io.quarkus.gizmo2.impl.GizmoImpl.lambda$class_$1(GizmoImpl.java:154)
	at io.github.dmlloyd.classfile.impl.ClassFileImpl.build(ClassFileImpl.java:144)
	at io.github.dmlloyd.classfile.ClassFile.build(ClassFile.java:558)
	at io.quarkus.gizmo2.impl.GizmoImpl.class_(GizmoImpl.java:151)
	at io.quarkus.gizmo2.Gizmo.class_(Gizmo.java:89)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.generateHandler(ReactiveRoutesProcessor.java:618)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.addAdditionalRoutes(ReactiveRoutesProcessor.java:431)
	at java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)
	at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:872)
	at io.quarkus.builder.BuildContext.run(BuildContext.java:255)
	at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)
	at org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2651)
	at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2630)
	at org.jboss.threads.EnhancedQueueExecutor.runThreadBody(EnhancedQueueExecutor.java:1622)
	at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1589)
	at java.base/java.lang.Thread.run(Thread.java:1583)
	at org.jboss.threads.JBossThread.run(JBossThread.java:501)

	at io.quarkus.runner.bootstrap.AugmentActionImpl.runAugment(AugmentActionImpl.java:375)
	at io.quarkus.runner.bootstrap.AugmentActionImpl.createInitialRuntimeApplication(AugmentActionImpl.java:292)
	at io.quarkus.runner.bootstrap.AugmentActionImpl.createInitialRuntimeApplication(AugmentActionImpl.java:60)
	at io.quarkus.deployment.dev.IsolatedDevModeMain.firstStart(IsolatedDevModeMain.java:89)
	at io.quarkus.deployment.dev.IsolatedDevModeMain.accept(IsolatedDevModeMain.java:432)
	at io.quarkus.deployment.dev.IsolatedDevModeMain.accept(IsolatedDevModeMain.java:55)
	at io.quarkus.bootstrap.app.CuratedApplication.runInCl(CuratedApplication.java:143)
	at io.quarkus.bootstrap.app.CuratedApplication.runInAugmentClassLoader(CuratedApplication.java:98)
	at io.quarkus.deployment.dev.DevModeMain.start(DevModeMain.java:104)
	at io.quarkus.deployment.dev.DevModeMain.main(DevModeMain.java:67)
Caused by: io.quarkus.builder.BuildException: Build failure: Build failed due to errors
	[error]: Build step io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor#addAdditionalRoutes threw an exception: java.lang.IllegalStateException: Item Invoke:RoutingContext.getBodyAsJson is not at its expected location (declare a LocalVar to store values which are used away from their creation site)
To track callers and get an improved exception message, add the system property `gizmo.debug`
	at io.quarkus.gizmo2.impl.Item.missing(Item.java:286)
	at io.quarkus.gizmo2.impl.Item.verify(Item.java:142)
	at io.quarkus.gizmo2.impl.Item.insertIfUnbound(Item.java:219)
	at io.quarkus.gizmo2.impl.Item.process(Item.java:260)
	at io.quarkus.gizmo2.impl.Invoke.forEachDependency(Invoke.java:80)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.addItem(BlockCreatorImpl.java:1444)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.invokeVirtual(BlockCreatorImpl.java:857)
	at io.quarkus.gizmo2.creator.BlockCreator.invokeVirtual(BlockCreator.java:2892)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$14(ReactiveRoutesProcessor.java:791)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.accept(BlockCreatorImpl.java:990)
	at io.quarkus.gizmo2.impl.TryCreatorImpl.lambda$body$0(TryCreatorImpl.java:41)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.nesting(BlockCreatorImpl.java:1514)
	at io.quarkus.gizmo2.impl.TryCreatorImpl.body(TryCreatorImpl.java:40)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$16(ReactiveRoutesProcessor.java:790)
	at io.quarkus.gizmo2.impl.TryCreatorImpl.accept(TryCreatorImpl.java:130)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.try_(BlockCreatorImpl.java:1153)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$23(ReactiveRoutesProcessor.java:789)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.accept(BlockCreatorImpl.java:990)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.doCode(ExecutableCreatorImpl.java:388)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.lambda$doBody$1(Executabl                                                                         eCreatorImpl.java:304)
	at io.github.dmlloyd.classfile.impl.DirectCodeBuilder.build(DirectCodeBuilder.java:93)
	at io.github.dmlloyd.classfile.impl.DirectMethodBuilder.withCode(DirectMethodBuilder.java:118)
	at io.github.dmlloyd.classfile.impl.DirectMethodBuilder.withCode(DirectMethodBuilder.java:125)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.doBody(ExecutableCreatorImpl.java:303)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.lambda$body$3(ExecutableCreatorImpl.java:418)
	at io.github.dmlloyd.classfile.impl.DirectMethodBuilder.run(DirectMethodBuilder.java:139)
	at io.github.dmlloyd.classfile.impl.DirectClassBuilder.withMethod(DirectClassBuilder.java:117)
	at io.github.dmlloyd.classfile.ClassBuilder.withMethod(ClassBuilder.java:313)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.body(ExecutableCreatorImpl.java:417)
	at io.quarkus.gizmo2.impl.InstanceMethodCreatorImpl.body(InstanceMethodCreatorImpl.java:15)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$24(ReactiveRoutesProcessor.java:699)
	at io.quarkus.gizmo2.impl.InstanceMethodCreatorImpl.accept(InstanceMethodCreatorImpl.java:19)
	at io.quarkus.gizmo2.impl.ClassCreatorImpl.method(ClassCreatorImpl.java:76)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.generateInvoke(ReactiveRoutesProcessor.java:696)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateHandler$6(ReactiveRoutesProcessor.java:659)
	at io.quarkus.gizmo2.impl.GizmoImpl.lambda$class_$1(GizmoImpl.java:154)
	at io.github.dmlloyd.classfile.impl.ClassFileImpl.build(ClassFileImpl.java:144)
	at io.github.dmlloyd.classfile.ClassFile.build(ClassFile.java:558)
	at io.quarkus.gizmo2.impl.GizmoImpl.class_(GizmoImpl.java:151)
	at io.quarkus.gizmo2.Gizmo.class_(Gizmo.java:89)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.generateHandler(ReactiveRoutesProcessor.java:618)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.addAdditionalRoutes(ReactiveRoutesProcessor.java:431)
	at java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)
	at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:872)
	at io.quarkus.builder.BuildContext.run(BuildContext.java:255)
	at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)
	at org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2651)
	at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2630)
	at org.jboss.threads.EnhancedQueueExecutor.runThreadBody(EnhancedQueueExecutor.java:1622)
	at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1589)
	at java.base/java.lang.Thread.run(Thread.java:1583)
	at org.jboss.threads.JBossThread.run(JBossThread.java:501)

	at io.quarkus.builder.Execution.run(Execution.java:139)
	at io.quarkus.builder.BuildExecutionBuilder.execute(BuildExecutionBuilder.java:78)
	at io.quarkus.deployment.QuarkusAugmentor.run(QuarkusAugmentor.java:160)
	at io.quarkus.runner.bootstrap.AugmentActionImpl.runAugment(AugmentActionImpl.java:371)
	... 9 more
Caused by: java.lang.IllegalStateException: Item Invoke:RoutingContext.getBodyAsJson is not at its expected location (declare a LocalVar to store values which are used away from their creation site)
To track callers and get an improved exception message, add the system property `gizmo.debug`
	at io.quarkus.gizmo2.impl.Item.missing(Item.java:286)
	at io.quarkus.gizmo2.impl.Item.verify(Item.java:142)
	at io.quarkus.gizmo2.impl.Item.insertIfUnbound(Item.java:219)
	at io.quarkus.gizmo2.impl.Item.process(Item.java:260)
	at io.quarkus.gizmo2.impl.Invoke.forEachDependency(Invoke.java:80)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.addItem(BlockCreatorImpl.java:1444)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.invokeVirtual(BlockCreatorImpl.java:857)
	at io.quarkus.gizmo2.creator.BlockCreator.invokeVirtual(BlockCreator.java:2892)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$14(ReactiveRoutesProcessor.java:791)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.accept(BlockCreatorImpl.java:990)
	at io.quarkus.gizmo2.impl.TryCreatorImpl.lambda$body$0(TryCreatorImpl.java:41)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.nesting(BlockCreatorImpl.java:1514)
	at io.quarkus.gizmo2.impl.TryCreatorImpl.body(TryCreatorImpl.java:40)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$16(ReactiveRoutesProcessor.java:790)
	at io.quarkus.gizmo2.impl.TryCreatorImpl.accept(TryCreatorImpl.java:130)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.try_(BlockCreatorImpl.java:1153)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$23(ReactiveRoutesProcessor.java:789)
	at io.quarkus.gizmo2.impl.BlockCreatorImpl.accept(BlockCreatorImpl.java:990)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.doCode(ExecutableCreatorImpl.java:388)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.lambda$doBody$1(ExecutableCreatorImpl.java:304)
	at io.github.dmlloyd.classfile.impl.DirectCodeBuilder.build(DirectCodeBuilder.java:93)
	at io.github.dmlloyd.classfile.impl.DirectMethodBuilder.withCode(DirectMethodBuilder.java:118)
	at io.github.dmlloyd.classfile.impl.DirectMethodBuilder.withCode(DirectMethodBuilder.java:125)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.doBody(ExecutableCreatorImpl.java:303)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.lambda$body$3(ExecutableCreatorImpl.java:418)
	at io.github.dmlloyd.classfile.impl.DirectMethodBuilder.run(DirectMethodBuilder.java:139)
	at io.github.dmlloyd.classfile.impl.DirectClassBuilder.withMethod(DirectClassBuilder.java:117)
	at io.github.dmlloyd.classfile.ClassBuilder.withMethod(ClassBuilder.java:313)
	at io.quarkus.gizmo2.impl.ExecutableCreatorImpl.body(ExecutableCreatorImpl.java:417)
	at io.quarkus.gizmo2.impl.InstanceMethodCreatorImpl.body(InstanceMethodCreatorImpl.java:15)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateInvoke$24(ReactiveRoutesProcessor.java:699)
	at io.quarkus.gizmo2.impl.InstanceMethodCreatorImpl.accept(InstanceMethodCreatorImpl.java:19)
	at io.quarkus.gizmo2.impl.ClassCreatorImpl.method(ClassCreatorImpl.java:76)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.generateInvoke(ReactiveRoutesProcessor.java:696)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.lambda$generateHandler$6(ReactiveRoutesProcessor.java:659)
	at io.quarkus.gizmo2.impl.GizmoImpl.lambda$class_$1(GizmoImpl.java:154)
	at io.github.dmlloyd.classfile.impl.ClassFileImpl.build(ClassFileImpl.java:144)
	at io.github.dmlloyd.classfile.ClassFile.build(ClassFile.java:558)
	at io.quarkus.gizmo2.impl.GizmoImpl.class_(GizmoImpl.java:151)
	at io.quarkus.gizmo2.Gizmo.class_(Gizmo.java:89)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.generateHandler(ReactiveRoutesProcessor.java:618)
	at io.quarkus.vertx.web.deployment.ReactiveRoutesProcessor.addAdditionalRoutes(ReactiveRoutesProcessor.java:431)
	at java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)
	at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:872)
	at io.quarkus.builder.BuildContext.run(BuildContext.java:255)
	at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)
	at org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2651)
	at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2630)
	at org.jboss.threads.EnhancedQueueExecutor.runThreadBody(EnhancedQueueExecutor.java:1622)
	at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1589)
	at java.base/java.lang.Thread.run(Thread.java:1583)
	at org.jboss.threads.JBossThread.run(JBossThread.java:501)
```
